<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>powerplant Index</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.flatly.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">powerplant</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="client.html">client</a></li><li><a href="client.actions.html">client.actions</a></li><li><a href="client.actions.headerActions.html">client.actions.headerActions</a></li><li><a href="client.actions.locationActions.html">client.actions.locationActions</a></li><li><a href="client.actions.types.html">client.actions.types</a></li><li><a href="client.actions.userActions.html">client.actions.userActions</a></li><li><a href="server.html">server</a></li><li><a href="server.app.html">server.app</a></li><li><a href="server.middleware.html">server.middleware</a></li><li><a href="server.middleware.authentication.html">server.middleware.authentication</a></li><li><a href="server.middleware.data-validation.html">server.middleware.data-validation</a></li><li><a href="server.migration.html">server.migration</a></li><li><a href="server.models.html">server.models</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="server.models.Companionship.html">server.models.Companionship</a></li><li><a href="server.models.Crop.html">server.models.Crop</a></li><li><a href="server.models.Location.html">server.models.Location</a></li><li><a href="server.models.User.html">server.models.User</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-8">
	
		<div id="main">
			

	
	











	
	





    <section class="readme-section">
        <article><p>Developer Documentation for powerplant
Last updated: Jul 28, 2017</p>
<p>{{&gt;toc}}</p>
<p>h1. Introduction</p>
<p>powerplant is a full-stack JS web app utilizing several external services and many interlocking components. The aim of this doc is to help you, as a developer, get familiar with all the parts of the software. It should act as a roadmap, showing you where each functionality of the software lies, and where each new functionality belongs.</p>
<p>It would be helpful to have</p>
<ul>
<li>A bit of working knowledge of javascript
** ES6 standards are a plus</li>
<li>Understanding of JS @Promises@</li>
<li>Understanding of the principles behind building a React app - see &quot;Thinking in React&quot;:https://facebook.github.io/react/docs/thinking-in-react.html</li>
<li>Knowledge of REST principles for building web APIs - see &quot;RESTful Web Services&quot;:http://restfulwebapis.org/RESTful_Web_Services.pdf</li>
</ul>
<p><em>NOTE</em> These would just be helpful. If you're like me, you started with none of these except for a bit of JS.</p>
<p><em>RELATED</em> If you see something in these docs that you think should be changed or see existing code that you think is leading the project down the wrong path and needs to be refactored or restructured, PLEASE work to change it! The project is in its early stages, and there are many features or implementation details that made it through simply because the project is so small. Also, I apologize if you find any awful code.</p>
<p>You can send questions, complaints, or hate mail to simoneverhale@gmail.com</p>
<p>h1. Setup</p>
<p>To start, you need to set up the development environment. This includes: NodeJS, Docker (with mongo db)</p>
<h1>&quot;Install Node&quot;:https://nodejs.org/en/download/package-manager/ you should install version 6.x</h1><h1>&quot;Install Docker&quot;:https://docs.docker.com/engine/installation/linux/docker-ce/ubuntu/#install-using-the-repository</h1><h1>Install the &quot;Mongo Docker image&quot;:https://hub.docker.com/_/mongo/ by running @docker pull mongo@</h1><h1>Clone the &quot;git repository&quot;:https://github.com/Ecohackerfarm/powerplant.git</h1><h1>Start the Docker image by running @npm run mongo@</h1><h1>Run the Firebase data migration by running @npm run migrate@</h1><h1>At this point, everything should be set up. Run @npm test@ to make sure everything is working, and @npm start@ to begin serving the website on @http://localhost:8080@</h1><h1>Done!</h1><p>h1. Architecture</p>
<p>h2. Codebase</p>
<p>The entire codebase, front and back, is written in ES6 using Babel to transpile to CommonJS. Through Babel and webpack, some importing conveniences are available, namely using a slash ('/') to specify the root of the project, allowing for absolute imports rather than just relative.</p>
<p>h2. Documentation</p>
<p>Documentation can be found in the @/docs@ folder. @/docs/index.html@ loads a fully navigatible documentation site. It is also available online through github pages at https://ecohackerfarm.github.io/powerplant</p>
<p>h3. JSDoc</p>
<p>All documentation is generated with JSDoc (and &quot;docstrap&quot;:https://www.npmjs.com/package/ink-docstrap for the template). See the http://usejsdoc.org/ for documentation on how to properly document things. The documentation pattern used is to make every folder and file a namespace (unless a file should not be its own namespace, like if you only ever import it through the directory's index.js). Each @namespace@ should also specify who it is a @memberof@. This allows for proper navigation of the file hierarchy in the documentation. Additionally, a plugin called &quot;jsdoc-memberof-namespace&quot;:https://www.npmjs.com/package/jsdoc-memberof-namespace is used to generate proper nesting structure for methods, constants, and classes within namespaces. This was the best way I could find to maintain the right file hierarchy in the documentation.</p>
<p>The one exception is that classes can be documented as @class@es rather than @namespace@s. This is only for things that you would instantiate with the @new@ keyword. Mongoose models, for example, can be documented as classes because they are instantiated as @new@ objects. Take a look at @/server/models@ for examples of how this works.</p>
<p>Here's an example for documenting a file called @bar@ within a folder called @foo@ (although you should be able to find plenty in the code, at least in @/server/data-validation@)</p>
<pre>
File: /foo/index.js
/**
 * @namespace foo
 */

File: /example/foo/bar
/**
 * @namespace bar
 * @memberof foo
 */
</pre>

<p>Pretty simple, right? Make sure to specify the full namespace in @memberof@, e.g. if foo was contained within baz, in bar you'd say it's a member of @baz.foo@, not just @foo@. You might need to add a few index.js files if there are folders that don't have them already.
NOTE: If you notice a function being skipped in the documentation, check if it's a default export! jsdoc-memberof-namespace has trouble with inline default export function declarations. Better to declare the function, then default export it, otherwise it may be skipped.</p>
<p>h2. Testing</p>
<p>You can run tests with the @npm test@ command. Note that in order to test the server code correctly, the tests must be able to connect to the mongo docker image. This connection happens in @/test/server/init.js@. You also need to have migrated the data to the mongodb database with @npm run migrate@. If you ever get a few odd failed tests (&quot;cannot get property '_id'&quot; or something like that), it's possible you forgot to migrate the data.</p>
<p>Tests are stored in the @/test@ folder. The structure of this folder should mirror the root file structure. This makes it easy to find the test module for any module. Tests should be written for every component that contains business logic or helper functions, as well as every API route. No tests need to be written for external library functions (like Mongoose @Models@). However, if you write an extensions to an external function, like a query function for a Mongoose @Model@, that should be tested.</p>
<p>Whenever possible, use unit testing to test a single component separate from the rest of the codebase.</p>
<p>If isolation is not possibe, integration tests are ok too. This is necessary for API tests, and possibly also for database functions.</p>
<p>All tests are dispatched with Mocha and use the @expect@ function from the assertion library Chai. API tests use supertest to create requests.</p>
<p>h3. Mocha</p>
<p>https://mochajs.org/</p>
<p>Mocha is the test-running framework which is used to organize the tests. It is used by the @npm test@ command as the environment in which the tests are run, so it does not need to be imported in any of the test classes.</p>
<p>We use the BDD (behaviour-drive-development) syntax, so the main functions used to organize tests are @describe@ and @it@. @describe@ is used to separate modules and functionalities within modules, and @it@ is used to describe a specific behaviour. Generally, tests for a module are organized with two levels of @describe@, the first being the name of the module, and the second being for a specific function or functionality. Test code then goes within an @it@ function in the second.</p>
<p>For example:</p>
<pre><code class="javascript">
describe('data-validation', () => { // module name
    describe('#idValidation()', () => { // function name
        it('should validate a correct id', () = > {
            // test code goes here
        });
    });
    describe('#getCompanionshipScores()', () => { // other function name
    it('should return correct scores', () => {
// test code goes here
});
    });
});
</code></pre>

<p>or</p>
<pre><code class="javascript">
describe('authReducer', () => { // module name
    describe('SET_CURRENT_USER', () => { //not a function, but a specific functionality
        it("should set the current user", () => {
            // test code goes here
        });
    });
});
</code></pre>

<p>Mocha tests run synchronously, but it does support asynchronous test code through the use of promises. To test asynchronous code, simply have the @it@ function return a promise. The next test will not execute until the promise is resolved.</p>
<p>h3. Chai</p>
<p>http://chaijs.com/, &quot;cheat sheet&quot;:https://gist.github.com/yoavniran/1e3b0162e1545055429e</p>
<p>Tests use the @expect@ function of Chai to assert that all things are as they should be. Each @expect@ call is an opportunity for a test to fail. If all @expect@ calls in an @it()@ function pass, the test passes. Chai supports function chaining to create self-documenting tests. See the cheat sheet above for an overview of the functions.</p>
<p>h3. Supertest</p>
<p>https://www.npmjs.com/package/supertest</p>
<p>Supertest allows testing of network request-based functionality (REST API routes, in our case). See the tests in @/test/server/routes/api/@ for examples. A supertest request return a promise, so it can be returned in an @it@ function and the test will wait until the request completes to continue.</p>
<p>h2. Front end</p>
<p>h3. React, react-router-dom</p>
<p>h3. Redux + redux-peresist + react-redux</p>
<p>Redux is the be-all-end-all of the state of the application (with very few exceptions, like form state). Every bit of user data is stored in redux. The store has the following architecture:</p>
<pre>
{
  title: String (default: "powerplant"), // the title that will be displayed in the window
  auth: {
    isAuthenticated: Bool (default: false),
    currentUser: User (default: null),
  },
  currLocation: Location (default: null),
  locations: [Location] (default: []),
  beds: [Bed] (default: []),
  crops: [Crop] (default: []),
  cropInfos: [CropInformation] (default: []),
  cropRelationships: [CropRelationship] (default: [])
}
</pre>

<p>In addition, the @redux-persist@ module saves the redux store in local storage and reloads (&quot;rehydrates&quot;) it every time the user visits the website. This is what allows users to save data without registering, and speeds up the process of displaying registered users' data. It also means that the website can be used offline if the page is loaded first.</p>
<p>h3. React-bootstrap</p>
<p>h3. Webpack</p>
<p>h2. Back end</p>
<p>h3. Node</p>
<p>h3. Express</p>
<p>h3. Mongoose</p>
<p>Mongoose is an ODM (object-document-model) library for Mongo DB. It abstracts some of the lower level features of mongo and makes it easy to create models and control them.</p>
<p>The database structure follows a relatively straightforward hierarchy:</p>
<pre>
+------------------------------------+
|      User                          |
+------------------------------------+
|       _id:ObjectId                 |
|  username:String                   |
|  password:String                   |
| locations:[ObjectId(ref:Location)] |
|                                    |
+n------------^----------------------+
 |            |
 |            |
 |          user
locations     |
 |            |
 |            |
+v------------1+---------------+
|     Location                 |
+------------------------------+
|   _id:ObjectId               |
|  beds:[Bed]                  |
|   loc:{coordinates:[Number], |
|         address:String}      |
|  user:ObjectId(ref:User)     |
|                              |
+----n--------------^----------+
     |              |
   beds          location
     |              |
+----v--------------1-----------------+
|          Bed                        |
+-------------------------------------+
|          _id:ObjectId               |
| active_crops:[ObjectId(ref:Crop)]   |
|   past_crops:[ObjectId(ref:Crop)]   |
|    soil_type:Enum                   |
|     location:ObjectId(ref:Location) |
|                                     |
|                                     |
+-----n------------^------------------+
      |            |
   active_crops    |
   past_crops     bed
      |            |
+-----v------------1----------------------+
|     Crop                                |
+-----------------------------------------+
|       _id:ObjectId                      |
|  bed:ObjectId(ref:Bed)                  |
|  crop_info:ObjectId(ref:CropInformation)|
|  planted_indoors:Date                   |
|  planted_in_bed:Date                    |
|  predicted_transplant:Date              |
|  predicted_harVest:Date                 |
+-----------------------------------------+

</pre>



<p>h1. Common tasks</p>
<p>h2. Front end</p>
<p>h3. Adding tests</p>
<p>h3. Adding a new page</p>
<p>h2. Back end</p>
<p>h3. Adding tests</p>
<p>h4. Unit tests</p>
<p>h4. Integration tests</p>
<p>h3. Modifying the database structure</p></article>
    </section>







		</div>
	</div>

	<div class="clearfix"></div>

	
		<div class="col-md-3">
			<div id="toc" class="col-md-3 hidden-xs hidden-sm hidden-md"></div>
		</div>
	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.3</a>
	
		on Saturday, July 29th 2017, 7:53:38 pm
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : false,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>