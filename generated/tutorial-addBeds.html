<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width">
	<title>powerplant Tutorial: addBeds</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.flatly.css">

</head>

<body>

<div class="navbar navbar-default navbar-fixed-top ">
<div class="container">
	<div class="navbar-header">
		<a class="navbar-brand" href="index.html">powerplant</a>
		<button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#topNavigation">
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
			<span class="icon-bar"></span>
        </button>
	</div>
	<div class="navbar-collapse collapse" id="topNavigation">
		<ul class="nav navbar-nav">
			
			<li class="dropdown">
				<a href="namespaces.list.html" class="dropdown-toggle" data-toggle="dropdown">Namespaces<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="cli.html">cli</a></li><li><a href="cli.api-client.html">cli.api-client</a></li><li><a href="cli.cli.html">cli.cli</a></li><li><a href="client.html">client</a></li><li><a href="client.actions.html">client.actions</a></li><li><a href="client.actions.actionHelpers.html">client.actions.actionHelpers</a></li><li><a href="client.actions.bedActions.html">client.actions.bedActions</a></li><li><a href="client.actions.cropActions.html">client.actions.cropActions</a></li><li><a href="client.actions.headerActions.html">client.actions.headerActions</a></li><li><a href="client.actions.locationActions.html">client.actions.locationActions</a></li><li><a href="client.actions.userActions.html">client.actions.userActions</a></li><li><a href="client.components.html">client.components</a></li><li><a href="client.components.about.html">client.components.about</a></li><li><a href="client.components.about.AboutPage.html">client.components.about.AboutPage</a></li><li><a href="client.components.App.html">client.components.App</a></li><li><a href="client.components.beds.html">client.components.beds</a></li><li><a href="client.components.beds.AddBedForm.html">client.components.beds.AddBedForm</a></li><li><a href="client.components.beds.AddBedsForm.html">client.components.beds.AddBedsForm</a></li><li><a href="client.components.beds.BedItem.html">client.components.beds.BedItem</a></li><li><a href="client.components.beds.BedPage.html">client.components.beds.BedPage</a></li><li><a href="client.components.beds.BedsPage.html">client.components.beds.BedsPage</a></li><li><a href="client.components.beds.EditBedForm.html">client.components.beds.EditBedForm</a></li><li><a href="client.components.crops.html">client.components.crops</a></li><li><a href="client.components.crops.ChooseCrops.html">client.components.crops.ChooseCrops</a></li><li><a href="client.components.crops.CropGroup.html">client.components.crops.CropGroup</a></li><li><a href="client.components.crops.CropGroups.html">client.components.crops.CropGroups</a></li><li><a href="client.components.header.html">client.components.header</a></li><li><a href="client.components.header.Header.html">client.components.header.Header</a></li><li><a href="client.components.header.HeaderBrand.html">client.components.header.HeaderBrand</a></li><li><a href="client.components.header.HeaderLoginNav.html">client.components.header.HeaderLoginNav</a></li><li><a href="client.components.header.HeaderLogoutNav.html">client.components.header.HeaderLogoutNav</a></li><li><a href="client.components.locations.html">client.components.locations</a></li><li><a href="client.components.locations.AddLocationForm.html">client.components.locations.AddLocationForm</a></li><li><a href="client.components.locations.LocationItem.html">client.components.locations.LocationItem</a></li><li><a href="client.components.locations.LocationPage.html">client.components.locations.LocationPage</a></li><li><a href="client.components.locations.LocationsPage.html">client.components.locations.LocationsPage</a></li><li><a href="client.components.login.html">client.components.login</a></li><li><a href="client.components.login.LoginForm.html">client.components.login.LoginForm</a></li><li><a href="client.components.login.LoginPage.html">client.components.login.LoginPage</a></li><li><a href="client.components.Main.html">client.components.Main</a></li><li><a href="client.components.register.html">client.components.register</a></li><li><a href="client.components.register.RegisterForm.html">client.components.register.RegisterForm</a></li><li><a href="client.components.register.RegisterPage.html">client.components.register.RegisterPage</a></li><li><a href="client.components.shared.html">client.components.shared</a></li><li><a href="client.components.shared.CrudableList.html">client.components.shared.CrudableList</a></li><li><a href="client.components.shared.CrudableList.AddItemPage.html">client.components.shared.CrudableList.AddItemPage</a></li><li><a href="client.components.shared.CrudableList.CrudableListPage.html">client.components.shared.CrudableList.CrudableListPage</a></li><li><a href="client.components.shared.CrudableList.CrudableListPage.AddItemForm.html">client.components.shared.CrudableList.CrudableListPage.AddItemForm</a></li><li><a href="client.components.shared.CrudableList.CrudableListPage.ItemListView.html">client.components.shared.CrudableList.CrudableListPage.ItemListView</a></li><li><a href="client.reducers.html">client.reducers</a></li><li><a href="client.reducers.app.html">client.reducers.app</a></li><li><a href="client.reducers.auth.html">client.reducers.auth</a></li><li><a href="client.reducers.crops.html">client.reducers.crops</a></li><li><a href="client.reducers.currLocation.html">client.reducers.currLocation</a></li><li><a href="client.reducers.locations.html">client.reducers.locations</a></li><li><a href="client.reducers.title.html">client.reducers.title</a></li><li><a href="client.styles.html">client.styles</a></li><li><a href="client.utils.html">client.utils</a></li><li><a href="server.html">server</a></li><li><a href="server.middleware.html">server.middleware</a></li><li><a href="server.models.html">server.models</a></li><li><a href="server.processor.html">server.processor</a></li><li><a href="server.server.html">server.server</a></li><li><a href="server.utils.html">server.utils</a></li><li><a href="shared.html">shared</a></li><li><a href="shared.combinations.html">shared.combinations</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="cli.api-client.ApiClient.html">cli.api-client.ApiClient</a></li><li><a href="client.AppProvider.html">client.AppProvider</a></li><li><a href="client.components.about.AboutPage.AboutPage.html">client.components.about.AboutPage.AboutPage</a></li><li><a href="client.components.App.App.html">client.components.App.App</a></li><li><a href="client.components.beds.AddBedForm.AddBedForm.html">client.components.beds.AddBedForm.AddBedForm</a></li><li><a href="client.components.beds.AddBedsForm.AddBedForm.html">client.components.beds.AddBedsForm.AddBedForm</a></li><li><a href="client.components.beds.BedItem.BedItem.html">client.components.beds.BedItem.BedItem</a></li><li><a href="client.components.beds.BedPage.BedPage.html">client.components.beds.BedPage.BedPage</a></li><li><a href="client.components.beds.BedsPage.BedsPage.html">client.components.beds.BedsPage.BedsPage</a></li><li><a href="client.components.beds.EditBedForm.EditBedForm.html">client.components.beds.EditBedForm.EditBedForm</a></li><li><a href="client.components.crops.ChooseCrops.ChooseCrops.html">client.components.crops.ChooseCrops.ChooseCrops</a></li><li><a href="client.components.crops.CropGroup.CropGroup.html">client.components.crops.CropGroup.CropGroup</a></li><li><a href="client.components.crops.CropGroups.CropGroups.html">client.components.crops.CropGroups.CropGroups</a></li><li><a href="client.components.header.Header.Header.html">client.components.header.Header.Header</a></li><li><a href="client.components.header.HeaderBrand.HeaderBrand.html">client.components.header.HeaderBrand.HeaderBrand</a></li><li><a href="client.components.header.HeaderLoginNav.HeaderLoginNav.html">client.components.header.HeaderLoginNav.HeaderLoginNav</a></li><li><a href="client.components.header.HeaderLogoutNav.HeaderLogoutNav.html">client.components.header.HeaderLogoutNav.HeaderLogoutNav</a></li><li><a href="client.components.locations.AddLocationForm.AddLocationForm.html">client.components.locations.AddLocationForm.AddLocationForm</a></li><li><a href="client.components.locations.LocationItem.LocationItem.html">client.components.locations.LocationItem.LocationItem</a></li><li><a href="client.components.locations.LocationPage.LocationPage.html">client.components.locations.LocationPage.LocationPage</a></li><li><a href="client.components.locations.LocationsPage.LocationsPage.html">client.components.locations.LocationsPage.LocationsPage</a></li><li><a href="client.components.login.LoginForm.LoginForm.html">client.components.login.LoginForm.LoginForm</a></li><li><a href="client.components.login.LoginPage.Login.html">client.components.login.LoginPage.Login</a></li><li><a href="client.components.Main.Main.html">client.components.Main.Main</a></li><li><a href="client.components.Recover.html">client.components.Recover</a></li><li><a href="client.components.register.RegisterForm.RegisterForm.html">client.components.register.RegisterForm.RegisterForm</a></li><li><a href="client.components.register.RegisterPage.RegisterPage.html">client.components.register.RegisterPage.RegisterPage</a></li><li><a href="client.components.shared.SetHeaderTitle.html">client.components.shared.SetHeaderTitle</a></li><li><a href="client.components.shared.TextFieldGroup.html">client.components.shared.TextFieldGroup</a></li><li><a href="server.models.Crop.html">server.models.Crop</a></li><li><a href="server.models.CropRelationship.html">server.models.CropRelationship</a></li><li><a href="server.models.Location.html">server.models.Location</a></li><li><a href="server.models.User.html">server.models.User</a></li><li><a href="server.processor.Processor.html">server.processor.Processor</a></li><li><a href="server.processor.ProcessorException.html">server.processor.ProcessorException</a></li><li><a href="shared.combinations.Combinations.html">shared.combinations.Combinations</a></li>
				</ul>
			</li>
			
			<li class="dropdown">
				<a href="tutorials.list.html" class="dropdown-toggle" data-toggle="dropdown">Tutorials<b class="caret"></b></a>
				<ul class="dropdown-menu ">
					<li><a href="tutorial-addBeds.html">addBeds</a></li>
				</ul>
			</li>
			
		</ul>
        
            <div class="col-sm-3 col-md-3">
                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search" name="q" id="search-input">
                        <div class="input-group-btn">
                            <button class="btn btn-default" id="search-submit"><i class="glyphicon glyphicon-search"></i></button>
                        </div>
                    </div>
                </form>
            </div>
        
	</div>

</div>
</div>


<div class="container" id="toc-content">
<div class="row">

	
	<div class="col-md-12">
	
		<div id="main">
			<section class="tutorial-section">

<header>
    

    <h2>addBeds</h2>
</header>

<article>
    <h1>Introduction</h1><p>At the time of writing (Aug. 2, 2017), the next major step in the project is to implement the rest of the data hierarchy (Users -&gt; Locations -&gt; Beds -&gt; Crops). Currently, there are users and locations. It is only logical that beds be implemented next.</p>
<p>A <strong>bed</strong> is defined in the software specifications as: &quot;Section in a garden (can be a greenhouse, a pot or a patch of soil)&quot;</p>
<p>This tutorial will go through the full process of implementing ONLY the list of beds, both front and back end. The order of these events is not so important; what matters is that it's all there. The result will be a fully editable list of beds which are stored within each location. They won't contain anything, they won't have schedules or tasks. That will all need to be added later, but in order to have a schedule there must be a Crop model first. I suggest implementing only the list views first, and then embellishing each one with tasks and schedules, once possible, to turn it into a multi-tabbed view.</p>
<p>At a later point, this list of beds will need to be expanded into a full Location view, as per the prototype. It will contain three tabs, one of which is the list of beds, the other two will be tasks and schedule (see &quot;Garden Dashboard&quot; on the prototype).</p>
<h2>Overview</h2><p>The front end components involved are</p>
<ul>
<li>React components to display the actual data<ul>
<li>A form for adding a new bed</li>
<li>A template for displaying a single item in the list of beds</li>
<li>A redux-connected component which sends all the relevant information to CrudableList to generate the page</li>
</ul>
</li>
<li>Redux actions to create, edit, and delete the data</li>
<li>Redux reducers to modify the store based on these actions</li>
<li>Unit tests for the actions and reducers</li>
</ul>
<p>The back end components involved are</p>
<ul>
<li>A mongoose model for a Bed object</li>
<li>Modification of the Location object to reference its beds</li>
<li>Creation of express middleware to check and fetch beds from add a list of ids</li>
<li>API routes to create, read, update, and destroy (CRUD)</li>
<li>Integration tests to ensure that all API routes are working as intended</li>
</ul>
<h1>Front End</h1><h2>React components</h2><p>Create presentational React components which will display a functional list of beds given the proper data. You will then be able to use a <a href="client.components.shared.CrudableList.html">CrudableList</a> to turn this into a fully functional and interactable list of data, similar to the locations list.</p>
<h3>New bed form</h3><p>You must create a form for adding a new bed. This will function as both the form to add a bed, and to edit one. Follow the specifications at <a href="client.components.shared.CrudableList.CrudableListPage.AddItemForm.html">CrudableList.AddItemForm</a> for information about the properties this form will take in. They must have these exact properties in order to be compatible with the CrudableList.</p>
<p>Having good error messages and user feedback in forms is important! This component should probably return a <code>form</code> element which utilizes <a href="client.components.shared.TextFieldGroup.html">TextFieldGroups</a> for all input groups. This is a shared component which handles error messages and validation states for you!</p>
<h3>List item</h3><p>A simple component for displaying a single bed item in the list of beds. This is not meant to contain all bed information, just a few key components. Maybe just a short list of current crops, a few icons indicating tasks (although tasks might not have been implemented yet, so that could be difficult).</p>
<blockquote>
<p><strong>NOTE</strong> unfortunately for this tutorial, I ACCIDENTALLY CLOSED WITHOUT SAVING after writing a bunch of it after this point. So it's going to be a little terser than usual, I probably won't link things because it's a pain to write, and I might sound a little angrier. Lesson learned, make sure you know which side of the split you're on before :q!</p>
</blockquote>
<p>Specifications for list item are at <a href="client.components.shared.CrudableList.CrudableListPage.ItemListView.html">client.components.shared.CrudableList.CrudableListPage.ItemListView</a> (see why I didn't want to type links???). For locations, I made it a panel. I'd recommend doing the same for consistency.</p>
<h3>Tying it all together</h3><p>For locations, this is <code>/client/components/locations/LocationsPage.js</code>. It creates a higher-order redux-connected component which passes in a whole bunch of things that the CrudableListPage needs. Once you have this, you have the whole editable list!</p>
<h2>Redux actions</h2><p>You will need actions to:</p>
<ul>
<li>Load all beds from the server</li>
<li>Save a bed</li>
<li>Edit a bed</li>
<li>Delete a bed</li>
</ul>
<p>For each of these, you will need</p>
<ul>
<li>An action request (the thing that gets wrapped in a dispatch call and passed to CrudableListPage) in <code>/client/actions/bedActions.js</code></li>
<li>A pure action creator in <code>/client/actions/index.js</code></li>
<li>An action type definition as a JSDoc <code>@typedef</code> in <code>/client/actions/index.js</code></li>
<li>An action type string constant in <code>/client/actions/types.js</code></li>
</ul>
<p>For writing the request, you can utilize <a href="client.actions.actionHelpers.html#.simpleAuthCheckedRequest">client.actions.actionHelpers.simpleAuthCheckedRequest</a>. See examples of its usage in <code>/client/actions/locationActions.js</code>.</p>
<h2>Redux reducers</h2><p>Reducers are pure functions (no side effects) which take in the previous state and an action and return the new state. You'll need to write a bed reducer, which takes in the previous list of beds and an action object and returns the new list of beds. It should go in <code>/client/reducers/beds.js</code> and have a named export as <code>beds</code> in <code>/client/reducers/index.js</code>.</p>
<h2>Unit tests</h2><p>I recommend following test-driven development for the actions and reducers and writing tests before writing the functions. I know I didn't do a great job with this for actions :( Learn from my mistakes!</p>
<h1>Back end</h1><h2>Mongoose model</h2><p>The outline of the bed model is in the dev docs (the home page of this documentation). I'll also put it right here.</p>
<pre class="prettyprint source"><code>    +----v--------------1-----------------+
    |          Bed                        |
    +-------------------------------------+
    |          _id:ObjectId               |
    | active_crops:[ObjectId(ref:Crop)]   |
    |   past_crops:[ObjectId(ref:Crop)]   |
    |    soil_type:Enum                   |
    |     location:ObjectId(ref:Location) |
    |         user:ObjectId(ref:User)     |
    |                                     |
    |                                     |
    +-----n------------^------------------+</code></pre><p>You can leave out active_crops and past_crops if they don't exist yet. Or make them empty lists and fill in the ref: part later. Also, now is a good time to go into the location model and add a list of bed ObjectIds.</p>
<h2>Express middleware</h2><p>Go to <code>/server/middleware/data-validation.js</code>. You can export functions similar to <code>getCrops</code>, <code>fetchCrops</code>, etc. for beds. These will handle the error responses for when someone asks for an invalid bed</p>
<h2>API routes</h2><p>Should go in <code>/server/routers/api/beds.js</code>. I think a flat API structure here is good, so I'd probably do something like <code>GET/PUT /beds/:bedId</code>, <code>POST /beds</code>, <code>GET /users/:id/beds</code> (that last one should go in the <code>users.js</code> router.</p>
<p>Make sure you use the middleware you just created to check/fetch beds. They just need to be put in the <code>ids</code> property of the request first. For sending back errors, use the <code>next(error)</code> call. All errors will get passed to a central API error handler middleware in <code>/server/routers/api.js</code>. The error object must have a status but that's the only required part. I liked to have a message property and then an errors object which could have errors for specific fields if applicable (like if handling form data).</p>
<h2>Integration tests</h2><p>Write a suit of integration tests which tests every API route. This is hugely important, because you don't want to have to manually check that the routes are doing what you want them to do. Again, TDD is really helpful here. Look at the <em>Testing</em> section of the dev docs for some guidelines.</p>
<p>Feel free to email me with questions/etc. I know this is a VERY unfinished project and this was my first large-scale full-stack software project. I'm sure there are plenty of places I could've done something much better.</p>
<p><em>Simon Ever-Hale</em></p>
<p><em>simoneverhale@gmail.com</em></p>
<p><em>Aug. 2, 2017</em></p>
</article>

</section>

		</div>
	</div>

	<div class="clearfix"></div>

	

</div>
</div>


    <div class="modal fade" id="searchResults">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h4 class="modal-title">Search results</h4>
          </div>
          <div class="modal-body"></div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
          </div>
        </div><!-- /.modal-content -->
      </div><!-- /.modal-dialog -->
    </div>


<footer>


<span class="jsdoc-message">
	Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a>
	
		on Sunday, February 11th 2018, 2:20:59 pm
	
	using the <a href="https://github.com/docstrap/docstrap">DocStrap template</a>.
</span>
</footer>

<script src="scripts/docstrap.lib.js"></script>
<script src="scripts/toc.js"></script>

    <script type="text/javascript" src="scripts/fulltext-search-ui.js"></script>


<script>
$( function () {
	$( "[id*='$']" ).each( function () {
		var $this = $( this );

		$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
	} );

	$( ".tutorial-section pre, .readme-section pre, pre.prettyprint.source" ).each( function () {
		var $this = $( this );

		var example = $this.find( "code" );
		exampleText = example.html();
		var lang = /{@lang (.*?)}/.exec( exampleText );
		if ( lang && lang[1] ) {
			exampleText = exampleText.replace( lang[0], "" );
			example.html( exampleText );
			lang = lang[1];
		} else {
			var langClassMatch = example.parent()[0].className.match(/lang\-(\S+)/);
			lang = langClassMatch ? langClassMatch[1] : "javascript";
		}

		if ( lang ) {

			$this
			.addClass( "sunlight-highlight-" + lang )
			.addClass( "linenums" )
			.html( example.html() );

		}
	} );

	Sunlight.highlightAll( {
		lineNumbers : false,
		showMenu : true,
		enableDoclinks : true
	} );

	$.catchAnchorLinks( {
        navbarOffset: 10
	} );
	$( "#toc" ).toc( {
		anchorName  : function ( i, heading, prefix ) {
			return $( heading ).attr( "id" ) || ( prefix + i );
		},
		selectors   : "#toc-content h1,#toc-content h2,#toc-content h3,#toc-content h4",
		showAndHide : false,
		smoothScrolling: true
	} );

	$( "#main span[id^='toc']" ).addClass( "toc-shim" );
	$( '.dropdown-toggle' ).dropdown();

    $( "table" ).each( function () {
      var $this = $( this );
      $this.addClass('table');
    } );

} );
</script>



<!--Navigation and Symbol Display-->


<!--Google Analytics-->



    <script type="text/javascript">
        $(document).ready(function() {
            SearcherDisplay.init();
        });
    </script>


</body>
</html>